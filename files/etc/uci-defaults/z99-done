#!/bin/sh

# --- SAFETY CHECK (The Loop Breaker) ---
# If this file exists, we have already run. Exit immediately.
if [ -f /etc/first_boot_done ];
then
    exit 0
fi

# --- MARK AS DONE ---
touch /etc/first_boot_done

# --- LOGGING ---
logger -p notice -t luci-defaults "First boot setup complete. Rebooting..."

# --- SCHEDULE REBOOT ---
# Sync ensures the marker is written to flash.
# Sleep 10s gives the OS time to handle the script deletion.
{ sync; sleep 10; reboot; } &

exit 0